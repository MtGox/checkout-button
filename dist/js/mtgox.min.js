// Generated by CoffeeScript 1.3.1
(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r=[].slice;e=[],p=!1,g=!1,h="https://payment.mtgox.com/css/mtgox.min.css",m="https://payment.mtgox.com/img/button-logo.v4.png",q="https://socketio.mtgox.com:443",l=document.head||document.getElementsByTagName("head")[0]||document.documentElement,d={},c=function(){function b(){}return b.name="Utility",b.inArray=function(a,b){var c,d,e;for(d=0,e=a.length;d<e;d++){c=a[d];if(c===b)return!0}return!1},b.getScript=function(a,b){var c;return c=document.createElement("script"),c.type="text/javascript",c.async="async",c.onload=c.onreadystatechange=function(a,d){if(d||!c.readyState||/loaded|complete/.test(c.readyState)){c.onload=c.onreadystatechange=null,l&&c.parentNode&&l.removeChild(c),c=void 0;if(!d)return b(200,"success")}},c.src=a,l.insertBefore(c,l.firstChild)},b.getElementsByClassName=function(c,d,e){var f,g,h,i,j,k;d==null&&(d=document.body),e==null&&(e="");if(document.getElementsByClassName)return d.getElementsByClassName(c);if(d.querySelectorAll!=null)return e=e||"",d.querySelectorAll(e+"."+c);e=e||"*",i=d.getElementsByTagName(e),g=[];for(j=0,k=i.length;j<k;j++)h=i[j],f=(new a(h)).getAttribute("class"),f!=null&&b.inArray(f.split(" "),c)&&g.push(h);return g},b.keys=function(a){var b,c,d;if(Object.keys!=null)return Object.keys(a);c=[];for(b in a)d=a[b],c.push(b);return c},b}(),a=function(){function a(a){this.element=a}return a.name="MtGoxElement",a.prototype.hasAttribute=function(a){return this.element.hasAttribute!=null?this.element.hasAttribute(a):this.element[a]!=null?!0:!1},a.prototype.getAttribute=function(a){return a==="class"&&this.element.className!=null?this.element.className:this.element.getAttribute!=null?this.element.getAttribute(a):this.element[a]!=null?this.element[a]:null},a.prototype.setAttribute=function(a,b){return a==="class"&&(this.element.className=b),this.element.setAttribute!=null?this.element.setAttribute(a,b):(this.element[a]=b,b)},a.prototype.appendChild=function(a){return this.element.appendChild(a.get())},a.prototype.clean=function(){var a;a=[];while(this.element.childNodes.length)a.push(this.element.removeChild(this.element.childNodes[0]));return a},a.prototype.get=function(){return this.element},a.prototype.setContent=function(a){return this.element.innerHTML=a},a.create=function(b,c,d){var e,f,g,h,i;c==null&&(c={}),b.indexOf(".")&&(i=b.split("."),b=i[0],f=2<=i.length?r.call(i,1):[],c["class"]=f.join(" ")),g=new a(document.createElement(b));for(e in c)h=c[e],g.setAttribute(e,h);return d!=null&&d.appendChild(g),g},a}(),i=window.MtGox.currencies,k=function(a,b){var c,d,e,f,g;return b=i[b]!=null?i[b]:i.USD,g=Math.pow(10,b.precision),a=(Math.round(a*g)/g).toString(),e=a.indexOf(".")>=0,f=0,c=parseInt(a),d=a-c,b.precision>0&&(e?f=a.length-a.indexOf(".")-1:a+=".",a+=(new Array(b.precision+1-f)).join("0")),b.format.replace("%s",b.symbol).replace("%v",a)},f=function(a,b,c){var d;return b==="BTC"?(d=i[c]!=null?i[c]:i.USD,a*d.rate):(d=i[b]!=null?i[b]:i.USD,a/d.rate)},b=function(){function a(){}return a.name="MtGoxSocket",a.parseSIOMessage=function(b){switch(b.op){case"private":return a.parseSIOPrivate(b["private"],b[b["private"]])}},a.parseSIOPrivate=function(b,c){switch(b){case"ticker":return i[c.buy.currency].rate=c.buy.value,a.updateButtons()}},a.updateButtons=function(){var a,b,c,d,g,h,i;i=[];for(g=0,h=e.length;g<h;g++)c=e[g],b=c.btc_element.getAttribute("data-amount"),a=c.btc_element.getAttribute("data-currency"),d=c.cur_element.getAttribute("data-currency"),i.push(c.cur_element.setContent(k(f(b,a,d),d)));return i},a.registerButtonUpdate=function(){var b,e;if(window.io)return b=window.io,e=b.connect(q+"/mtgox?Currency="+c.keys(d).join(",")+"&Channel=ticker"),e.on("message",a.parseSIOMessage)},a}.call(this),o=function(b){var c,g,h,i,j,l,n,o,p,q,r,s,t,u;if(b.nodeType==null)return!1;b=new a(b),q={},u=["data-id","data-amount","data-currency"];for(s=0,t=u.length;s<t;s++){c=u[s];if(!b.hasAttribute(c))return!1;q[c.replace("data-","")]=b.getAttribute(c)}return q.custom=b.hasAttribute("data-custom")?b.getAttribute("data-custom"):!1,q.currency==="BTC"?(j="USD",d.USD=!0):(j="BTC",d[q.currency]=!0),r="https://payment.mtgox.com/"+q.id,q.custom!==!1&&(r+="?custom="+encodeURIComponent(q.custom)),l=a.create("a.mtgox-button",{href:r,target:"_blank"}),n=a.create("span.mtgox-button-amount",{},l),h=k(q.amount,q.currency),g=a.create("span.mtgox-button-base",{"data-amount":q.amount,"data-currency":q.currency},n),g.setContent(h),a.create("br",{},n),i=a.create("span.mtgox-button-dist",{"data-currency":j},n),i.setContent(k(f(q.amount,q.currency,j),j)),o=a.create("span.mtgox-button-logo",{},n),p={src:m},a.create("img",p,o),b.clean(),b.appendChild(l),e.push({element:b,btc_element:g,cur_element:i})},n=!1,j=function(){var d,e,f,i,j,k;if(n===!0)return!0;g||(g=!0,d={rel:"stylesheet",type:"text/css",href:h},e=a.create("link",d),l.insertBefore(e.get(),l.firstChild)),k=c.getElementsByClassName("mtgox");for(i=0,j=k.length;i<j;i++)f=k[i],o(f);return p||(p=!0,c.getScript(q+"/socket.io/socket.io.js",b.registerButtonUpdate)),n=!0},document.readyState==="complete"?j():document.addEventListener!=null?(document.addEventListener("DOMContentLoaded",j,!1),document.addEventListener("load",j,!1)):(document.attachEvent("onreadystatechange",j),document.attachEvent("onload",j)),window.MtGox.button=o}).call(this);